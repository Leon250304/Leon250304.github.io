<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>3D LoD2 Gebäude (Cesium)</title>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.125/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.125/Build/Cesium/Cesium.js"></script>
  <style>
    html, body, #cesiumContainer { width:100%; height:100%; margin:0; padding:0; overflow:hidden; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; }
    #notice { position: absolute; top: 8px; left: 8px; z-index: 1000; background: rgba(255,255,255,0.9); padding:6px 8px; border-radius:6px; font-size:13px; }
  </style>
</head>
<body>
  <div id="notice">3D-Ansicht: LoD2-Gebäude (Cesium). Klicke, um in voller Größe zu öffnen.</div>
  <div id="cesiumContainer"></div>

  <script>
    (async function () {
      // optional: Cesium.Ion.defaultAccessToken = 'YOUR_TOKEN_HERE';

      // Create the viewer without a default imagery provider; we add providers explicitly.
      const viewer = new Cesium.Viewer('cesiumContainer', {
        timeline: false,
        animation: false,
        geocoder: false,
        homeButton: true,
        baseLayerPicker: false,
        sceneModePicker: true,
        navigationHelpButton: false,
        infoBox: true,
        selectionIndicator: true,
        fullscreenButton: true,
        imageryProvider: false
      });

      // OpenStreetMap as basemap
      const osm = new Cesium.OpenStreetMapImageryProvider({
        url: 'https://a.tile.openstreetmap.org/'
      });
      viewer.imageryLayers.addImageryProvider(osm);

      // Optional WMS layer for Germany (Smart Mapping)
      try {
        const provider = new Cesium.WebMapServiceImageryProvider({
          url: 'https://sgx.geodatenzentrum.de/wms_basemapde?SERVICE=WMS&REQUEST=GetCapabilities',
          layers: 'de_basemapde_web_raster_farbe',
          parameters: { transparent: true, format: 'image/png' }
        });
        viewer.imageryLayers.addImageryProvider(provider);
      } catch (err) {
        console.warn('WMS provider konnte nicht geladen werden:', err);
      }

      // Set camera to a good overview position
      viewer.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(6.958215, 50.932767, 1500.0),
        orientation: {
          heading: Cesium.Math.toRadians(0.0),
          pitch: Cesium.Math.toRadians(-50.0),
          roll: 0.0
        }
      });

      // Load 3D-tileset (LoD2 Gebäude)
      try {
        const tileset = new Cesium.Cesium3DTileset({
          url: 'https://sg.geodatenzentrum.de/gdz_basemapde_3d_gebaeude/lod2_4978_null.json'
        });
        viewer.scene.primitives.add(tileset);
        await tileset.readyPromise;

        // Simple style for surfaces
        tileset.style = new Cesium.Cesium3DTileStyle({
          color: {
            conditions: [
              ["${surface} === 'wall'", "color('#f2f2f2')"],
              ["${surface} === 'roof'", "color('#ff5c4d')"],
              ["${surface} === 'bridge'", "color('#999999')"],
              ["true", "color('#ffffff')"]
            ]
          }
        });

        // Zoom to tileset when ready
        await viewer.zoomTo(tileset);
      } catch (error) {
        console.error('Fehler beim Laden des 3D-Tilesets:', error);
      }

    })();
  </script>
</body>
</html>
